<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <meta content="ie=edge" http-equiv="X-UA-Compatible">
    <title>大事件-列表页</title>
    <link href="css/reset.css" rel="stylesheet" type="text/css">
    <link href="css/font-awesome.min.css" rel="stylesheet">
    <link href="css/jquery.pagination.css" rel="stylesheet" type="text/css">
    <link href="css/main.css" rel="stylesheet" type="text/css">
    <script src="js/jquery-1.12.4.min.js" type="text/javascript"></script>
    <script src="js/jquery.pagination.min.js" type="text/javascript"></script>
    <script src="admin/libs/http.js"></script>
    <!--    页码-->
    <script src="./admin/js/page.js"></script>
    <link href="./admin/css/page.css" rel="stylesheet">
</head>

<body>
<div class="header">
    <a class="logo fl" href="#"><img alt="logo" src="images/logo.png"></a>
    <div class="search_form fl">
        <input class="search_txt" placeholder="黑洞照片" type="text">
        <button class="search_btn"><i class="fa fa-search"></i></button>
    </div>
    <div class="link_info fr">
        <a href="#"><i class="fa fa-angle-right"></i>&nbsp;&nbsp;网站地图</a><br>
        <a href="#"><i class="fa fa-angle-right"></i>&nbsp;&nbsp;招聘信息</a>
    </div>
</div>

<div class="menu_con">
    <div class="menu">
        <div class="menu_collapse fl">
            <a class="level_one" href="javascript:;"><i class="fa fa-list-ul"></i>全部分类</a>
            <ul class="level_two">
                <li class="up"></li>
                <li><a href="#">最 新</a></li>
                <li><a href="#">科 技</a></li>
                <li><a href="#">股 市</a></li>
                <li><a href="#">商 品</a></li>
                <li><a href="#">外 汇</a></li>
                <li><a href="#">公 司</a></li>
            </ul>
        </div>
        <ul class="left_menu fl">
            <li><a href="#">最 新</a></li>
            <li><a href="#">科 技</a></li>
            <li><a href="#">股 市</a></li>
            <li><a href="#">商 品</a></li>
            <li><a href="#">外 汇</a></li>
            <li><a href="#">公 司</a></li>
        </ul>
        <ul class="right_menu fr">
            <li><a href="#">科技专题</a></li>
            <li><a href="#">财经专题</a></li>
        </ul>
    </div>
</div>

<div class="main_con clearfix">
    <div class="left_con setfr">
        <div class="list_title">
            <h3 id="htitle3"></h3>
        </div>
        <div id="cont"></div>

        <div class="page" id="pagination">
            <div class="pageTest" style="display: inline-block"></div>
        </div>


    </div>
    <div class="right_con setfl">
        <div class="common_wrap">
            <h3><i class="fa fa-bar-chart"></i> 一周热门排行</h3>
            <ul class="content_list" id="content_list">
                <li><span class="first">1</span><a href="#">神奇的水滴摄影，泡泡中的世界泡泡中的世界</a></li>
                <li><span class="second">2</span><a href="#">神奇的水滴摄影，泡泡中的世界</a></li>
                <li><span class="third">3</span><a href="#">神奇的水滴摄影，泡泡中的世界</a></li>
                <li><span>4</span><a href="#">神奇的水滴摄影，泡泡中的世界</a></li>
                <li><span>5</span><a href="#">神奇的水滴摄影，泡泡中的世界</a></li>
                <li><span>6</span><a href="#">神奇的水滴摄影，泡泡中的世界</a></li>
                <li><span>7</span><a href="#">神奇的水滴摄影，泡泡中的世界</a></li>
            </ul>
        </div>
        <div class="common_wrap">
            <h3><i class="fa fa-commenting-o"></i> 最新评论</h3>
            <ul class="content_list comment_list">
                <li>
                    <span>山</span>
                    <b><em>山治</em> 9个月前(08-14)说:</b>
                    <strong>挺会玩的</strong>
                </li>
                <li>
                    <span>丽</span>
                    <b><em>丽丽</em> 9个月前(08-14)说:9个月前(08-14)说:9个月前(08-14)说:</b>
                    <strong>挺会玩的挺会玩的挺会玩的挺会玩的</strong>
                </li>
                <li>
                    <span>R</span>
                    <b><em>Rechael</em> 9个月前(08-14)说:</b>
                    <strong>挺会玩的</strong>
                </li>
                <li>
                    <span>J</span>
                    <b><em>John</em> 9个月前(08-14)说:</b>
                    <strong>挺会玩的</strong>
                </li>
                <li>
                    <span>段</span>
                    <b><em>段正淳</em> 9个月前(08-14)说:</b>
                    <strong>挺会玩的</strong>
                </li>
                <li>
                    <span>乔</span>
                    <b><em>乔峰</em> 9个月前(08-14)说:</b>
                    <strong>挺会玩的</strong>
                </li>
            </ul>
        </div>
        <div class="common_wrap">
            <h3><i class="fa fa-bullseye"></i> 焦点关注</h3>
            <ul class="content_list guanzhu_list">
                <li><a href="#">神奇的水滴摄影，泡泡中的世界泡泡中的世界</a></li>
                <li><a href="#">神奇的水滴摄影，泡泡中的世界</a></li>
                <li><a href="#">神奇的水滴摄影，泡泡中的世界</a></li>
                <li><a href="#">神奇的水滴摄影，泡泡中的世界</a></li>
                <li><a href="#">神奇的水滴摄影，泡泡中的世界</a></li>
                <li><a href="#">神奇的水滴摄影，泡泡中的世界</a></li>
                <li><a href="#">神奇的水滴摄影，泡泡中的世界</a></li>
            </ul>
        </div>
    </div>
</div>

<div class="footer clearfix">
    <div class="foot_link">
        <a href="#">关于我们</a>
        <span>|</span>
        <a href="#">联系我们</a>
        <span>|</span>
        <a href="#">招聘人才</a>
        <span>|</span>
        <a href="#">友情链接</a>
    </div>
    <p>CopyRight © 2019 深圳大事件信息技术股份有限公司 All Rights Reserved</p>
    <p>电话：0755-****888 粤ICP备*******8号</p>
</div>
<!-- 导包template -->
<script src="./js/template-web.js"></script>
<script id="content" type="text/html">
    {{each data.data v}}
    <div class="common_news_list">
        <a href="#" class="list_pic"><img src="{{v.cover}}" alt=""></a>
        <h4><a href="#" data-id="{{v.id}}">{{v.title}}</a></h4>
        <p>{{v.content}}
        </p>
        <div class="new_info">
                    <span>标签：{{v.category}}&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;<i class="fa fa-eye"></i>&nbsp;阅读( {{v.read}}
                        )&nbsp;&nbsp;&nbsp;<i class="fa fa-commenting"></i>&nbsp;评论( {{v.comments}} )</span>
            <b>发布于 {{v.date}}</b>
        </div>
    </div>
    {{/each}}
</script>
<!--热门排行-->
<script id="remen" type="text/html">
    {{each data v i}}
    {{if i == 0}}
    <li><span class="first">1</span><a href="#" data-id="{{v.id}}" style="width: 183px;">{{v.title}}</a></li>
    {{else if i == 1}}
    <li><span class="second">2</span><a href="#" data-id="{{v.id}}">{{v.title}}</a></li>
    {{else if i == 2}}
    <li><span class="third">3</span><a href="#" data-id="{{v.id}}">{{v.title}}</a></li>
    {{else}}
    <li><span>{{i+1}}</span><a href="#" data-id="{{v.id}}">{{v.title}}</a></li>
    {{/if}}
    {{/each}}
</script>
<!--最新评论-->
<script id="rmmb" type="text/html">
    {{each data v}}
    <li>
        <span>{{v.author[0]}}</span>
        <b><em>{{v.author}}</em> {{v.time}}({{v.date}})说:</b>
        <strong>{{v.intro}}</strong>
    </li>
    {{/each}}
</script>
<!--焦点关注-->
<script id="jdgz" type="text/html">
    {{each data v}}
    <li><a href="#">{{v.intro}}</a></li>
    {{/each}}
</script>
</body>

<script>
	function timesFun(timesData) {
		//如果时间格式是正确的，那下面这一步转化时间格式就可以不用了
		var dateBegin = new Date(timesData.replace(/-/g, "/"));//将-转化为/，使用new Date
		var dateEnd = new Date();//获取当前时间
		var dateDiff = dateEnd.getTime() - dateBegin.getTime();//时间差的毫秒数
		var dayDiff = Math.floor(dateDiff / (24 * 3600 * 1000));//计算出相差天数
		var leave1 = dateDiff % (24 * 3600 * 1000)    //计算天数后剩余的毫秒数
		var hours = Math.floor(leave1 / (3600 * 1000))//计算出小时数
		//计算相差分钟数
		var leave2 = leave1 % (3600 * 1000)    //计算小时数后剩余的毫秒数
		var minutes = Math.floor(leave2 / (60 * 1000))//计算相差分钟数
		//计算相差秒数
		var leave3 = leave2 % (60 * 1000)      //计算分钟数后剩余的毫秒数
		var seconds = Math.round(leave3 / 1000);
		var timesString = '';

		if (dayDiff != 0) {
			if (dayDiff >= 31) {
				timesString = Math.floor(dayDiff / 31) + '月之前';
			} else {
				timesString = dayDiff + '天之前';
			}
		} else if (dayDiff == 0 && hours != 0) {
			timesString = hours + '小时之前';
		} else if (dayDiff == 0 && hours == 0) {
			timesString = minutes + '分钟之前';
		}

		return timesString
	}

	$.ajax({
		type: 'get',
		url: baseobj.latest_comment,
		success: function (msg) {
			// console.log(msg);
			for (var i = 0; i < msg.data.length; i++) {
				msg.data[i].time = timesFun(msg.data[i].date + " " + msg.data[i].time);
				msg.data[i].date = msg.data[i].date.substr(msg.data[i].date.indexOf('-') + 1, msg.data[i].date.length)
			}
			timesFun(msg.data[0].date + " " + msg.data[0].time).log;
			$('.comment_list').html(template('rmmb', msg));
		}
	});

	function ajaxfns(obj, lei, mblei) {
		$.ajax({
			url: obj,
			type: 'get',
			success: function (msg) {
				// console.log(msg);
				lei.html(template(mblei, msg));
			}
		});
	}

	function tiaozhuan(dom) {
		var id = dom.attr('data-id');
		sessionStorage.setItem('wzid', id);
		window.location.href = './article.html'
	}

	$('.pageTest').page({
		leng: 10,//分页总数
		activeClass: 'activP', //active 类样式定义
	});
	var key = true, xr = 0, htil = false, id;
	if(window.location.href.split('=')[1] == null) { $('.search_txt').val(sessionStorage.getItem('key'));htil = true }else{ id = window.location.href.split('=')[1];}

	// search
	function ajaxfn(page, key) {
		$.ajax({
			type: 'get',
			url: baseobj.search,
			data: {type: id, page: page, key: key},
			success: function (msg) {
				console.log(msg);
				if (xr == 0) {
					if (msg.data.data.length == 0 || htil) {
						$('#htitle3').text('全站搜索');
					} else {
						$('#htitle3').text(msg.data.data[0].category);
						xr = 2;
					}
				}
				if (msg.data.totalCount == 0) {
					$('#cont').html('<h3>该类型中没有搜索到相关信息，请换一个关键词，或换一个类型搜索</h3>');
				} else {
					$('#cont').html(template('content', msg));
				}
				if (key) {
					key = false;
					$('.pageTest').setLength(Math.ceil(msg.data.totalCount / 6));
				} else {
					key = true;
				}

			}
		});
	}

	//页码点击事件
	$('.pageTest').page({
		clickBack: function (page) {
			key = false;
			ajaxfn(page,$('.search_txt').val());
		}
	});
	//热门排行
	ajaxfns(baseobj.rank, $('#content_list'), 'remen');
	//热门排行点击事件
	$('.right_con').on('click', '#content_list a', function () {
		tiaozhuan($(this))
	});
	//焦点关注 attention
	ajaxfns(baseobj.attention, $('.guanzhu_list'), 'jdgz');
	//搜索事件
	$('.search_txt').keydown(function (e) {
		if (e.keyCode == 13) {
			$('.search_btn').click()
		}
	});
	$('.search_btn').click(function () {
		key = true;
		ajaxfn(1,$('.search_txt').val());
	});
	$('.search_btn').click();
	//文章详情点击事件
	function tiaozhuan(dom){
		var id = dom.attr('data-id');
		sessionStorage.setItem('wzid', id);
		window.location.href = './article.html'
	};
	$('.left_con').on('click','.common_news_list h4 a',function () {
        tiaozhuan($(this));
	})
</script>
</html>